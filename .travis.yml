sudo: false
language: php
php:
  - 5.6

before_install:
    - export DISPLAY=:99.0
    - sh -e /etc/init.d/xvfb start
before_script:
    - cp app/config/parameters.yml.dist app/config/parameters.yml
    - sed -i 's/%database_name%/%database_name%_test/' app/config/base_config.yml
    - mysql -e 'create database overwatch_test;'
    - wget -NP bin/ http://selenium-release.storage.googleapis.com/2.47/selenium-server-standalone-2.47.0.jar
    - composer install --prefer-dist
    - php app/console doctrine:schema:create --env=test
    - java -jar bin/selenium-server-standalone-2.47.0.jar > /dev/null 2>&1 &
    - php app/console server:start
script: phpunit -c app/

branches:
  only:
    - master

cache:
  directories:
    - vendor
    - bin/selenium-server-standalone-2.47.0.jar
    - $HOME/.composer/cache
